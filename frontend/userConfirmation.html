<!DOCTYPE html>
<html>

<head>
<link href="https://fonts.googleapis.com/css?family=Source Code Pro" rel="stylesheet">
<link rel="stylesheet" href="static/table.css" type="text/css">
<style>
    body{
      background-image: url("https://www.natrajindiancuisinevietnam.com/img/slider/slide01.jpg");   
  background-size: cover;  
  margin: 0;
    }

.title{
  background: rgb(30, 30, 40);
  color: white;
  font-family: 'Source Code Pro';
}
</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>â€©
<script src="https://js.stripe.com/v3/"></script>
<link rel="stylesheet" href="static/table.css" type="text/css">

<script>

      function submitChecks() {
         var stripe = Stripe('pk_test_d3OIYzLIan4NGotYARF05gcp00VcXEXPPI');
          stripe.redirectToCheckout({sessionId: '{{CHECKOUT_SESSION_ID}}'}).then(function(result) {
            alert("done")
            finalPage(); 
          });
        }

      function finalPage() {
          const url = "/qrCodePage";
          data = {
            orderId: document.getElementById("id").textContent,
          };
          
          function handleResponse(response)
          { 
            $("html").html(response);
          };
          if (request != null) request.abort();
          request = $.ajax(
               {
                  type: "POST",
                  url: url,
                  data: data,
                  success: handleResponse
               }
            );

       function changeOrder() {
         const url = "/confirmationPageReloaded";
          data = {
            orderId: document.getElementById("id").textContent,
            foodId: document.getElementById("foodId").textContent,
            name: document.getElementById("name").textContent,
            price: document.getElementById("price").textContent,
            quanity: document.getElementById("quantity").textContent
          };
          
          function handleResponse(response)
          { 
            $("div").html(response);
          };
          if (request != null) request.abort();
          request = $.ajax(
               {
                  type: "POST",
                  url: url,
                  data: data,
                  success: handleResponse
               }
        }

        function addQuantity() {
         const url = "/confirmationPageReloadedQuantity";
          data = {
            orderId: document.getElementById("id").textContent,
            foodId: document.getElementById("foodId").textContent,
            name: document.getElementById("name").textContent,
            price: document.getElementById("price").textContent,
            quantity: document.getElementById("quantity").textContent
            addQuantity: document.getElementById("addQuantity").value
            subtractQuantity: ""
          };

          function handleResponse(response)
          { 
            $("#quantity").html(response);
          };
          if (request != null) request.abort();
          request = $.ajax(
               {
                  type: "POST",
                  url: url,
                  data: data,
                  success: handleResponse
               }
        }

        function subtractQuantity() {
         const url = "/confirmationPageReloadedQuantity";
          data = {
            orderId: document.getElementById("id").textContent,
            foodId: document.getElementById("foodId").textContent,
            name: document.getElementById("name").textContent,
            price: document.getElementById("price").textContent,
            quantity: document.getElementById("quantity").textContent
            addQuantity: ""
            subtractQuantity: document.getElementById("subtractQuantity").value
          };
          
          function handleResponse(response)
          { 
            $("#quantity").html(response);
          };
          if (request != null) request.abort();
          request = $.ajax(
               {
                  type: "POST",
                  url: url,
                  data: data,
                  success: handleResponse
               }
        }
         
          // If `redirectToCheckout` fails due to a browser or network
          // error, display the localized error message to your customer
          // using `result.error.message`.


        }

          // const url = "/qrCodePage";
          // alert(document.getElementById("id").textContent)
          // data = {
          //   orderId: document.getElementById("id").textContent,
          // }
          
          // var request = null; 

          // function handleResponse(response)
          // { 
          //   $("html").html(response);
          // }

          // if (request != null)
          //   request.abort();

          // request = $.ajax(
          //      {
          //         type: "POST",
          //         url: url,
          //         data: data,
          //         success: handleResponse
          //      }
      //       );
      // }
      

</script>

</head>

  <head>
  <title>Chennai Chimney</title> 
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <ul class="topnav">
        <li><a class="active" href="/about"><span class="vertical"><b>Re</b></span>Eats</a></li>
        <li class="right"><a href="/logout">Logout</a></li>
        <li class="right"><a href="/userFeedback">Feedback</a></li>
        <li class="right"><a href="/userFP">Checkout</a></li>
        <li class="right"><a href="/userAccount">Account</a></li>
        <li class="right"><a href="/userFP">Menu</a></li>           
    </ul>
  </head>

  <body>
    <div class="title" >

    <hr style="background-color: #1e1e28">

        <center>
        <label><strong>Chennai Chimney: Order Confirmation
            </strong></label></center>

    <hr color ="black">
     </div>
      <center>
     <label style="color: #cc6666"><strong>Order Number:</strong></label> 
          <label id="id" style="color: white"><strong>{{orderId}}</strong></label></center>
    
    <form action="/qrCodePage", method="post"></form>
    <center>
    <table cellspacing="2" cellpadding="2" style = "align:center">  
      <tr>
        <th><strong>Item No.</strong></th>
        <th><strong>Name</strong></th>

        <th><strong>List Price</strong></th>
        <th><strong>Quantity</strong></th>
        <th><strong>Subtotal</strong></th>
        <th><strong>Remove Item</strong></th>
        <th><strong>Change Quantity</strong></th>


       </tr>
       <div id = "list">
       {% for item in foodList %}
      <tr>
        <tr>
          <td id = "foodId" > {{ item[0]}}</td>
          <td id = "name" > {{ item[2]}}</td>
          <td id = "price" > {{ item[1]}}</td>
          <td id = "quantity" >{{ item[3]|int}}</td>
          <td>{{"%.2f"|format(item[3]*item[1])}}</td>
          <td>
            <a input type="submit" value="X" onclick="changeOrder()"></a>
          </td>
          <td>
            <a id = "addQuantity" input type="submit" value="+" onclick="addQuantity()"></a>
            <a id = "subtractQuantity" input type="submit" value="-" onclick="subtractQuantity()"></a>
          </td>
        </tr>
        {% endfor %}
      </div>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>Total:{{"%.2f"|format(total)}}</td>
      </tr>

      </tr> 
    </table>
      </center>

    <p align="center">
    <input type="submit" value="SUBMIT" onclick="submitChecks()"> 
    </p>
  </form>
</head>

  </body>
</html>
