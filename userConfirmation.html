<!DOCTYPE html>
<html>

<head>
<link href="https://fonts.googleapis.com/css?family=Source Code Pro" rel="stylesheet">
<style>
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
  font-family: 'Source Code Pro';
}

tr:nth-child(even){background-color: #f2f2f2}

th {
  background-color: #b34444;
  color: white;
  font-family: 'Source Code Pro';
}

hr {
  background: rgb(30, 30, 40);
  color: white;
}

.title{
  background: rgb(30, 30, 40);
  color: white;
  font-family: 'Source Code Pro';
}
</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>â€©
<script src="https://js.stripe.com/v3/"></script>


<script>

      function submitChecks() {
         // var sessionid = {{CHECKOUT_SESSION_ID}};
         var stripe = Stripe('pk_test_d3OIYzLIan4NGotYARF05gcp00VcXEXPPI');
          stripe.redirectToCheckout({sessionId: '{{CHECKOUT_SESSION_ID}}'}).then(function(result) {
            alert("done")
            finalPage(); 
          });
        }

      function finalPage() {
          const url = "/qrCodePage";
          data = {
            orderId: document.getElementById("id").textContent,
          };
          
          function handleResponse(response)
          { 
            $("html").html(response);
          };
          if (request != null) request.abort();
          request = $.ajax(
               {
                  type: "POST",
                  url: url,
                  data: data,
                  success: handleResponse
               }
            );
         
          // If `redirectToCheckout` fails due to a browser or network
          // error, display the localized error message to your customer
          // using `result.error.message`.


        }

          // const url = "/qrCodePage";
          // alert(document.getElementById("id").textContent)
          // data = {
          //   orderId: document.getElementById("id").textContent,
          // }
          
          // var request = null; 

          // function handleResponse(response)
          // { 
          //   $("html").html(response);
          // }

          // if (request != null)
          //   request.abort();

          // request = $.ajax(
          //      {
          //         type: "POST",
          //         url: url,
          //         data: data,
          //         success: handleResponse
          //      }
      //       );
      // }
      

</script>

</head>

  <head>
  <title>Chennai Chimney</title> 
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

  <div class="topnav">

     <div class="w3-bar w3-white w3-wide w3-padding w3-card">
      <a href="#home" class="w3-bar-item w3-button"><b>Re</b> Eats</a>

      <div class="w3-right w3-hide-small">

        <a label href = "/userFP" ></label> <span class="w3-bar-item w3-button">Menu</a>

        <a label href = "/userAccount" ></label> <span class="w3-bar-item w3-button">Account</a>

        <a label href = "/userFP" ></label> <span class="w3-bar-item w3-button">Checkout</a>

        <a label href = "/userFeedback" ></label> <span class="w3-bar-item w3-button">Feedback</a>

        <a label href = "/logout" ></label> <span class="w3-bar-item w3-button">Logout</a>

      </div>
    </div>

    </a>
  </div>

  </head>

  <body>
    <div class="title" >

    <hr style="background-color: #1e1e28">


        <label
          style = "padding-left: 575px"
          ><strong>Chennai Chimney: Order Confirmation
        </strong></label>

    <hr color ="black">
     </div>
     <label style = "padding-left: 575px"
          ><strong>Order Number:</strong></label> 
          <label id="id"><strong>{{orderId}}</strong></label>

    <form action="/qrCodePage", method="post"></form>
    <table cellspacing="2" cellpadding="2" style = "align:center">  
      <tr>
        <th><strong>Item No.</strong></th>
        <th><strong>Name</strong></th>

        <th><strong>List Price</strong></th>
        <th><strong>Quantity</strong></th>
        <th><strong>Subtotal</strong></th>
       </tr>


      {% for item in foodList %}
      <tr>
        <tr>
          <td>{{ item[0]}}</td>
          <td>{{ item[2]}}</td>
          <td>{{ item[1]}}</td>
          <td>{{ item[3]|int}}</td>
          <td>{{"%.2f"|format(item[3]*item[1])}}</td>
        </tr>
        {% endfor %}



      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>Total:{{"%.2f"|format(total)}}</td>
      </tr>

      </tr> 
    </table>


    <p align="center">
    <input type="submit" value="SUBMIT" onclick="submitChecks()"> 
    </p>
  </form>
</head>

  </body>
</html>